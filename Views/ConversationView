import SwiftUI
//
//  Contact.swift
//  STWMessagingApp
//
//  Created by khawla on 01/11/2025.
//

/// Displays a single conversation between the user and a selected contact.
/// Supports sending text messages and displaying existing ones.
struct ConversationView: View {
    @ObservedObject var viewModel: ConversationViewModel
    @State private var newMessageText = ""
    
    var body: some View {
        VStack {
            // Messages List
            ScrollView {
                ForEach(viewModel.messages) { message in
                    MessageRowView(message: message, isCurrentUser: message.sender == "Me")
                }
            }
            
            Divider()
            
            // Message input bar
            HStack {
                TextField("Type a message...", text: $newMessageText)
                    .textFieldStyle(RoundedBorderTextFieldStyle())
                
                Button(action: {
                    viewModel.sendTextMessage(newMessageText)
                    newMessageText = ""
                }) {
                    Image(systemName: "paperplane.fill")
                        .font(.system(size: 20))
                }
                .disabled(newMessageText.isEmpty)
            }
            .padding()
        }
        .navigationTitle(viewModel.contact.firstName)
    }
}

#Preview {
    ConversationView(viewModel: ConversationViewModel(contact: Contact(firstName: "Khawla", lastName: "Ben Omar", phoneNumber: "+21600000000")))
}

